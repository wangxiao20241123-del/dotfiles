# 全局规则

- 尽量使用中文输出，专业术语、代码、命令等保持原文

## 文档规范

### 文档内容原则

1. **说明架构和方案**: 系统如何组织、模块如何划分、选择了什么技术路线
2. **解释设计原因**: 为什么这样设计、权衡了哪些因素、有什么约束
3. **不写代码细节**: 函数签名、参数类型、具体实现逻辑等代码自明的内容不需要文档化

### 计划文档写作原则（强约束）

**计划/设计文档只讲原则和契约，不堆代码。**

| 应该写 | 不应该写 |
|--------|----------|
| 设计原则、架构决策 | 完整的接口定义/函数签名 |
| 行为定义（输入→输出） | 伪代码/实现逻辑 |
| 状态机（用文字或图） | 大段 Go/Python/TS 代码块 |
| API 契约（简短 JSON 示例） | 完整的 struct/type 定义 |
| 验收标准（命令+预期） | 代码注释示例 |
| 边界和约束 | 错误处理的具体实现 |

**原因**：
- 代码细节在实现时自然产生，提前写会过时
- 执行者需要的是"做什么"和"边界"，不是"怎么写"
- 过多代码让计划臃肿，掩盖真正重要的决策

### 文档结构

1. **AGENTS.md**: 索引文件，告诉 AI 去哪找详细文档
2. **详细文档**: 独立 .md 文件，就近放置（和相关代码/配置在一起）
3. **树状结构**: 子目录的 AGENTS.md 会在读取该目录文件时自动加载

### 创建文档时

1. 文档就近放置（和相关代码/配置在一起）
2. 更新该目录的 AGENTS.md，添加文档索引

### 更新文档时

1. 同步更新 AGENTS.md 的索引（如果内容、位置或用途变了）

### 代码变更时

1. 修改代码/配置后，检查是否有相关文档需要同步更新
2. 文档内容应与实际实现保持一致

### 删除/迁移文档时

1. 同步删除或更新 AGENTS.md 中的索引条目
2. 检查是否有其他文档引用了该文档，更新相关链接

### 跨目录引用

1. 索引只放在本目录的 AGENTS.md 中
2. 引用其他目录的文档时，使用相对路径链接

### 索引粒度

1. 每条索引的"什么时候读"和"包含内容"各 2-5 点
2. 避免冗长，保持精炼

### 文档索引规范

创建或更新文档索引时：

1. 阅读完整文档内容
2. 提炼总结，生成索引条目
3. 索引放在该目录的 AGENTS.md 中

### 索引格式

每个文档索引条目必须包含以下字段：

| 字段 | 作用 | 要求 |
|------|------|------|
| **文档路径** | 文档的相对路径 | 必填，相对于当前 AGENTS.md 的路径 |
| **什么时候读** | 触发 AI 阅读该文档的场景 | 2-5 个具体场景 |
| **包含内容** | 文档的关键内容点 | 2-5 个要点 |

**格式示例**：

| 文档 | 什么时候读 | 包含内容 |
|------|------------|----------|
| `./docs/architecture.md` | 修改系统架构时、添加新模块时 | 系统整体架构、模块划分原则 |
| `./api/README.md` | 添加 API 端点时、修改请求响应格式时 | API 设计规范、错误处理约定 |

### 计划文档

计划文档指未实现功能的设计、改进计划、技术方案等。

**存放位置**: `.sisyphus/plans/`

**生命周期**:
1. **创建**: 新计划放入 `.sisyphus/plans/{计划名}.md`
2. **实现**: 功能实现后，删除计划文档
3. **废弃**: 决定不实现时，直接删除

**注意事项**:
- 计划文档不需要在 AGENTS.md 中索引
- 不要在 docs/ 或其他目录存放计划文档
- 计划文档有时效性，定期清理过时计划
